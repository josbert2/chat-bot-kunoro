!function(){"use strict";class n{constructor(n,o){this.siteKey=n,this.baseUrl=o||(()=>{if("undefined"==typeof window)return"http://localhost:3001";const n=document.currentScript;return(null==n?void 0:n.getAttribute("data-api-url"))||"http://localhost:3001"})()}setVisitorId(n){this.visitorId=n}async init(n){const o=await fetch(`${this.baseUrl}/v1/widget/init`,{method:"POST",headers:{"Content-Type":"application/json","x-site-key":this.siteKey},body:JSON.stringify({visitorId:n,pageUrl:window.location.href,userAgent:navigator.userAgent})});if(!o.ok)throw new Error(`Widget init failed: ${o.statusText}`);return o.json()}async sendMessage(n,o){const t=await fetch(`${this.baseUrl}/v1/widget/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-site-key":this.siteKey},body:JSON.stringify({conversationId:n||void 0,content:o,visitorId:this.visitorId,pageUrl:"undefined"!=typeof window?window.location.href:void 0,userAgent:"undefined"!=typeof navigator?navigator.userAgent:void 0})});if(!t.ok)throw new Error(`Send message failed: ${t.statusText}`);return t.json()}}const o="saas_chat_visitor_id",t={getVisitorId:()=>"undefined"==typeof window?null:localStorage.getItem(o),setVisitorId(n){"undefined"!=typeof window&&localStorage.setItem(o,n)},removeVisitorId(){"undefined"!=typeof window&&localStorage.removeItem(o)}},e={background:"#0F172A",action:"#2563EB"};function i(n){return function(n){const o=n.replace("#","");return(.299*parseInt(o.substr(0,2),16)+.587*parseInt(o.substr(2,2),16)+.114*parseInt(o.substr(4,2),16))/255<.55}(n)?"#ffffff":"#111827"}function r(n){const{visitorId:o,apiClient:t,config:r}=n,a=r.colors||e,s=i(a.background),d=i(a.action);console.log("üé® [Widget UI] Colores que se van a aplicar:",{colors:a,textColorBackground:s,textColorAction:d}),function(n,o,t){if(document.getElementById("kunoro-widget-styles"))return;const e=`\n    @keyframes fadeIn {\n      from { opacity: 0; transform: translateY(10px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n\n    @keyframes bounce {\n      0%, 60%, 100% { transform: translateY(0); }\n      30% { transform: translateY(-10px); }\n    }\n\n    #kunoro-chat-widget {\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      z-index: 999999;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    }\n\n    #kunoro-chat-button {\n      width: 56px;\n      height: 56px;\n      border-radius: 50%;\n      background-color: ${n.action};\n      border: none;\n      cursor: pointer;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.2s ease;\n    }\n\n    #kunoro-chat-button:hover {\n      transform: scale(1.05);\n      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);\n      opacity: 0.9;\n    }\n\n    #kunoro-chat-button svg {\n      stroke: ${t};\n    }\n\n    #kunoro-chat-window {\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      width: 380px;\n      background: white;\n      border-radius: 8px;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n      display: none;\n      flex-direction: column;\n      overflow: hidden;\n      border: 1px solid #e5e7eb;\n      z-index: 999998;\n    }\n\n    #kunoro-chat-window.open {\n      display: flex;\n      height: 600px;\n      animation: fadeIn 0.3s ease;\n    }\n\n    #kunoro-chat-header {\n      background-color: ${n.background};\n      color: ${o};\n      padding: 16px;\n      border-bottom: 1px solid #e5e7eb;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    #kunoro-chat-header svg {\n      stroke: ${o};\n    }\n\n    #kunoro-chat-messages {\n      flex: 1;\n      overflow-y: auto;\n      padding: 20px;\n      background: white;\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    }\n\n    #kunoro-chat-messages::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    #kunoro-chat-messages::-webkit-scrollbar-track {\n      background: transparent;\n    }\n\n    #kunoro-chat-messages::-webkit-scrollbar-thumb {\n      background: #d1d5db;\n      border-radius: 3px;\n    }\n\n    .kunoro-message {\n      display: flex;\n      animation: fadeIn 0.3s ease;\n    }\n\n    .kunoro-message.user {\n      justify-content: flex-end;\n    }\n\n    .kunoro-message-content {\n      max-width: 80%;\n      border-radius: 18px;\n      padding: 12px 16px;\n      font-size: 14.5px;\n      line-height: 1.45;\n      white-space: pre-wrap;\n    }\n\n    .kunoro-message.user .kunoro-message-content {\n      background-color: ${n.action};\n      color: ${t};\n    }\n\n    .kunoro-message.assistant .kunoro-message-content {\n      background-color: #f3f4f6;\n      color: #111827;\n    }\n\n    .kunoro-typing {\n      display: flex;\n      justify-content: flex-start;\n      animation: fadeIn 0.3s ease;\n    }\n\n    .kunoro-typing-content {\n      background-color: #f3f4f6;\n      border-radius: 16px;\n      padding: 12px 16px;\n      display: flex;\n      gap: 6px;\n    }\n\n    .kunoro-typing-dot {\n      width: 8px;\n      height: 8px;\n      border-radius: 50%;\n      background: #9ca3af;\n      animation: bounce 1.4s infinite;\n    }\n\n    .kunoro-typing-dot:nth-child(2) { animation-delay: 0.1s; }\n    .kunoro-typing-dot:nth-child(3) { animation-delay: 0.2s; }\n\n    #kunoro-chat-input {\n      flex: 1;\n      padding: 12px 16px;\n      font-size: 14.5px;\n      border: 1px solid #d1d5db;\n      border-radius: 8px;\n      outline: none;\n      transition: border-color 0.2s, box-shadow 0.2s;\n      font-family: inherit;\n    }\n\n    #kunoro-chat-input:focus {\n      border-color: ${n.action};\n      box-shadow: 0 0 0 2px ${n.action}20;\n    }\n\n    #kunoro-chat-send {\n      padding: 12px;\n      background-color: ${n.action};\n      color: ${t};\n      border: none;\n      border-radius: 8px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: opacity 0.2s;\n    }\n\n    #kunoro-chat-send:hover:not(:disabled) {\n      opacity: 0.9;\n    }\n\n    #kunoro-chat-send:disabled {\n      opacity: 0.4;\n      cursor: not-allowed;\n    }\n\n    #kunoro-chat-send svg {\n      stroke: ${t};\n    }\n\n    @media (max-width: 768px) {\n      #kunoro-chat-window {\n        width: calc(100vw - 40px);\n        height: calc(100vh - 120px) !important;\n      }\n    }\n  `,i=document.createElement("style");i.id="kunoro-widget-styles",i.textContent=e,document.head.appendChild(i)}(a,s,d),function(){if(document.getElementById("kunoro-chat-widget"))return;const n='\n    <div id="kunoro-chat-widget">\n      <button id="kunoro-chat-button" aria-label="Abrir chat">\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2">\n          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>\n        </svg>\n      </button>\n      \n      <div id="kunoro-chat-window">\n        <div id="kunoro-chat-header">\n          <div style="display: flex; justify-content: space-between; align-items: center;">\n            <div>\n              <h3 style="margin: 0; font-size: 15px; font-weight: 600;">Kunoro</h3>\n              <p style="margin: 4px 0 0 0; font-size: 12px; opacity: 0.8;">En l√≠nea</p>\n            </div>\n            <button id="kunoro-chat-close" style="background: none; border: none; cursor: pointer; padding: 4px;">\n              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke-width="2">\n                <line x1="18" y1="6" x2="6" y2="18"/>\n                <line x1="6" y1="6" x2="18" y2="18"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n        \n        <div id="kunoro-chat-messages"></div>\n        \n        <div style="padding: 16px; border-top: 1px solid #e5e7eb; background: white;">\n          <div style="display: flex; gap: 8px;">\n            <input \n              type="text" \n              id="kunoro-chat-input" \n              placeholder="Escribe un mensaje..."\n            />\n            <button id="kunoro-chat-send">\n              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke-width="2">\n                <line x1="22" y1="2" x2="11" y2="13"/>\n                <polygon points="22 2 15 22 11 13 2 9 22 2"/>\n              </svg>\n            </button>\n          </div>\n          <p style="text-align: center; font-size: 11px; color: #9ca3af; margin-top: 10px;">‚ö° Powered by Kunoro</p>\n        </div>\n      </div>\n    </div>\n  ',o=document.createElement("div");o.innerHTML=n,document.body.appendChild(o)}(),function(n,o,t){const e=document.getElementById("kunoro-chat-button"),i=document.getElementById("kunoro-chat-window"),r=document.getElementById("kunoro-chat-close"),a=document.getElementById("kunoro-chat-input"),s=document.getElementById("kunoro-chat-send"),d=document.getElementById("kunoro-chat-messages");let c=!1,l=null,u=!1;const p=[];function g(){if(c=!c,c){if(null==i||i.classList.add("open"),e.style.display="none",null==a||a.focus(),0===p.length){h(t.welcomeMessage||"¬°Hola! üëã\n\n¬øEn qu√© puedo ayudarte hoy?","assistant")}}else null==i||i.classList.remove("open"),e.style.display="flex"}function h(n,o){p.push({role:o,content:n,timestamp:new Date}),f()}function f(){d&&(d.innerHTML="",p.forEach(n=>{const o=document.createElement("div");o.className=`kunoro-message ${n.role}`;const t=document.createElement("div");t.className="kunoro-message-content",t.textContent=n.content,o.appendChild(t),d.appendChild(o)}),d.scrollTop=d.scrollHeight)}function y(){if(document.getElementById("kunoro-typing"))return;const n=document.createElement("div");n.className="kunoro-typing",n.id="kunoro-typing";const o=document.createElement("div");o.className="kunoro-typing-content",o.innerHTML='<div class="kunoro-typing-dot"></div><div class="kunoro-typing-dot"></div><div class="kunoro-typing-dot"></div>',n.appendChild(o),null==d||d.appendChild(n),d&&(d.scrollTop=d.scrollHeight)}function m(){const n=document.getElementById("kunoro-typing");n&&n.remove()}async function b(){const o=null==a?void 0:a.value.trim();if(o&&!u){h(o,"user"),a.value="",u=!0,s&&s.setAttribute("disabled","true"),y();try{const t=await n.sendMessage(l||"",o);m(),t.conversationId&&(l=t.conversationId),h(t.message||"Mensaje recibido","assistant")}catch(t){console.error("[Kunoro Widget] Error sending message:",t),m(),h("Lo siento, hubo un error. Por favor intenta de nuevo.","assistant")}finally{u=!1,s&&s.removeAttribute("disabled"),null==a||a.focus()}}}null==e||e.addEventListener("click",g),null==r||r.addEventListener("click",g),null==s||s.addEventListener("click",b),null==a||a.addEventListener("keypress",n=>{"Enter"!==n.key||n.shiftKey||(n.preventDefault(),b())}),window.KunoroWidget={open:()=>{c||g()},close:()=>{c&&g()},toggle:g,sendMessage:n=>{c||g(),setTimeout(()=>{a&&(a.value=n),b()},300)}}}(t,0,r),console.log("[Widget UI] Inicializado con configuraci√≥n:",r)}async function a(){var o,i;let a=document.currentScript;if(!a){console.log("[Kunoro Widget] currentScript no disponible, buscando script con data-app-id...");const n=document.querySelectorAll("script[data-app-id], script[data-key]");a=n[n.length-1]}const s=(null==a?void 0:a.getAttribute("data-key"))||(null==a?void 0:a.getAttribute("data-app-id")),d=(null==a?void 0:a.getAttribute("data-api-url"))||"http://localhost:3001",c=null==a?void 0:a.getAttribute("data-color-background"),l=null==a?void 0:a.getAttribute("data-color-action");if(console.log("[Kunoro Widget] Script encontrado:",{siteKey:s,apiUrl:d,dataBackground:c,dataAction:l,scriptSrc:null==a?void 0:a.src}),s){console.log(`[Kunoro Widget] Inicializando v1.0.0 para app: ${s}`);try{let a=t.getVisitorId();const p=new n(s,d);let g;try{const n=await p.init(a);n.visitorId&&n.visitorId!==a&&(t.setVisitorId(n.visitorId),a=n.visitorId),p.setVisitorId(a),g=n.widgetConfig||{colors:e}}catch(u){console.warn("[Kunoro Widget] No se pudo obtener configuraci√≥n del API, usando valores por defecto:",u),a||(a=`visitor_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,t.setVisitorId(a)),p.setVisitorId(a),g={colors:e}}(c||l)&&(console.log("[Kunoro Widget] Usando colores de data attributes:",{dataBackground:c,dataAction:l,configColorsAntes:g.colors}),g.colors={background:c||(null==(o=g.colors)?void 0:o.background)||e.background,action:l||(null==(i=g.colors)?void 0:i.action)||e.action},console.log("[Kunoro Widget] Colores despu√©s de aplicar data attributes:",g.colors)),g.colors||(console.log("[Kunoro Widget] No hay colores, usando defaults"),g.colors=e),console.log("[Kunoro Widget] Colores finales aplicados:",g.colors),r({siteKey:s,visitorId:a,apiClient:p,config:g}),console.log("[Kunoro Widget] ‚úÖ Widget cargado correctamente")}catch(p){console.error("[Kunoro Widget] Error al inicializar:",p)}}else console.error("[Kunoro Widget] Falta el atributo data-key o data-app-id en el script")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()}();
